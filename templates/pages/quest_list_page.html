{% extends "layouts/three_pane_layout.html" %}
{% load static wagtailcore_tags %}

{#
Context variables expected:
- quests: List of quest objects with title, url, difficulty, xp_reward, estimated_hours, skills, progress
- filters: Dict with active filters (difficulty, type, tags, xp_min, xp_max)
- user_stats: Dict with completed_count, total_xp, current_streak
- recommended_quests: List of recommended quest objects
- page_obj: Paginator page object for pagination
#}

{% block navigation_sidebar %}
<div class="p-gh-4 space-y-gh-6">
    <!-- Filters Header -->
    <div class="flex items-center justify-between border-b border-gh-border-default dark:border-gray-700 pb-gh-3">
        <h2 class="text-lg font-semibold text-gh-neutral-emphasis dark:text-white">Filters</h2>
        {% if filters %}
        <button
            type="button"
            onclick="window.location.href='?'"
            class="text-sm text-gh-accent-fg dark:text-gh-accent-muted hover:text-gh-accent-emphasis dark:hover:text-gh-accent-fg hover:underline">
            Clear all
        </button>
        {% endif %}
    </div>

    <form method="get" action="" x-data="{ autoSubmit: false }" @change="autoSubmit && $el.submit()">
        <!-- Difficulty Filter -->
        <div class="filter-section mb-gh-6">
            <h3 class="text-sm font-semibold text-gh-neutral-emphasis dark:text-white mb-gh-3">Difficulty</h3>
            <div class="space-y-gh-2">
                <label class="flex items-center gap-gh-2 cursor-pointer hover:bg-gh-bg-muted dark:hover:bg-gray-800 p-gh-2 rounded-gh transition-colors">
                    <input
                        type="checkbox"
                        name="difficulty"
                        value="easy"
                        {% if 'easy' in filters.difficulty %}checked{% endif %}
                        class="rounded border-gh-border-default dark:border-gray-600 text-gh-accent-emphasis dark:text-gh-accent-muted focus:ring-gh-accent-emphasis dark:focus:ring-gh-accent-muted">
                    <span class="text-sm text-gh-neutral-default dark:text-gray-200">Easy</span>
                    <span class="badge-gh badge-gh-success ml-auto">Beginner</span>
                </label>
                <label class="flex items-center gap-gh-2 cursor-pointer hover:bg-gh-bg-muted dark:hover:bg-gray-800 p-gh-2 rounded-gh transition-colors">
                    <input
                        type="checkbox"
                        name="difficulty"
                        value="medium"
                        {% if 'medium' in filters.difficulty %}checked{% endif %}
                        class="rounded border-gh-border-default dark:border-gray-600 text-gh-accent-emphasis dark:text-gh-accent-muted focus:ring-gh-accent-emphasis dark:focus:ring-gh-accent-muted">
                    <span class="text-sm text-gh-neutral-default dark:text-gray-200">Medium</span>
                    <span class="badge-gh badge-gh-warning ml-auto">Intermediate</span>
                </label>
                <label class="flex items-center gap-gh-2 cursor-pointer hover:bg-gh-bg-muted dark:hover:bg-gray-800 p-gh-2 rounded-gh transition-colors">
                    <input
                        type="checkbox"
                        name="difficulty"
                        value="hard"
                        {% if 'hard' in filters.difficulty %}checked{% endif %}
                        class="rounded border-gh-border-default dark:border-gray-600 text-gh-accent-emphasis dark:text-gh-accent-muted focus:ring-gh-accent-emphasis dark:focus:ring-gh-accent-muted">
                    <span class="text-sm text-gh-neutral-default dark:text-gray-200">Hard</span>
                    <span class="badge-gh badge-gh-danger ml-auto">Advanced</span>
                </label>
            </div>
        </div>

        <!-- Type Filter -->
        <div class="filter-section mb-gh-6">
            <h3 class="text-sm font-semibold text-gh-neutral-emphasis dark:text-white mb-gh-3">Quest Type</h3>
            <div class="space-y-gh-2">
                <label class="flex items-center gap-gh-2 cursor-pointer hover:bg-gh-bg-muted dark:hover:bg-gray-800 p-gh-2 rounded-gh transition-colors">
                    <input
                        type="checkbox"
                        name="type"
                        value="coding"
                        {% if 'coding' in filters.type %}checked{% endif %}
                        class="rounded border-gh-border-default dark:border-gray-600 text-gh-accent-emphasis dark:text-gh-accent-muted focus:ring-gh-accent-emphasis dark:focus:ring-gh-accent-muted">
                    <span class="text-sm text-gh-neutral-default dark:text-gray-200">Coding</span>
                </label>
                <label class="flex items-center gap-gh-2 cursor-pointer hover:bg-gh-bg-muted dark:hover:bg-gray-800 p-gh-2 rounded-gh transition-colors">
                    <input
                        type="checkbox"
                        name="type"
                        value="design"
                        {% if 'design' in filters.type %}checked{% endif %}
                        class="rounded border-gh-border-default dark:border-gray-600 text-gh-accent-emphasis dark:text-gh-accent-muted focus:ring-gh-accent-emphasis dark:focus:ring-gh-accent-muted">
                    <span class="text-sm text-gh-neutral-default dark:text-gray-200">Design</span>
                </label>
                <label class="flex items-center gap-gh-2 cursor-pointer hover:bg-gh-bg-muted dark:hover:bg-gray-800 p-gh-2 rounded-gh transition-colors">
                    <input
                        type="checkbox"
                        name="type"
                        value="research"
                        {% if 'research' in filters.type %}checked{% endif %}
                        class="rounded border-gh-border-default dark:border-gray-600 text-gh-accent-emphasis dark:text-gh-accent-muted focus:ring-gh-accent-emphasis dark:focus:ring-gh-accent-muted">
                    <span class="text-sm text-gh-neutral-default dark:text-gray-200">Research</span>
                </label>
                <label class="flex items-center gap-gh-2 cursor-pointer hover:bg-gh-bg-muted dark:hover:bg-gray-800 p-gh-2 rounded-gh transition-colors">
                    <input
                        type="checkbox"
                        name="type"
                        value="testing"
                        {% if 'testing' in filters.type %}checked{% endif %}
                        class="rounded border-gh-border-default dark:border-gray-600 text-gh-accent-emphasis dark:text-gh-accent-muted focus:ring-gh-accent-emphasis dark:focus:ring-gh-accent-muted">
                    <span class="text-sm text-gh-neutral-default dark:text-gray-200">Testing</span>
                </label>
                <label class="flex items-center gap-gh-2 cursor-pointer hover:bg-gh-bg-muted dark:hover:bg-gray-800 p-gh-2 rounded-gh transition-colors">
                    <input
                        type="checkbox"
                        name="type"
                        value="documentation"
                        {% if 'documentation' in filters.type %}checked{% endif %}
                        class="rounded border-gh-border-default dark:border-gray-600 text-gh-accent-emphasis dark:text-gh-accent-muted focus:ring-gh-accent-emphasis dark:focus:ring-gh-accent-muted">
                    <span class="text-sm text-gh-neutral-default dark:text-gray-200">Documentation</span>
                </label>
            </div>
        </div>

        <!-- Tags Filter -->
        <div class="filter-section mb-gh-6">
            <h3 class="text-sm font-semibold text-gh-neutral-emphasis dark:text-white mb-gh-3">Popular Tags</h3>
            <div class="flex flex-wrap gap-gh-2">
                <label class="cursor-pointer">
                    <input type="checkbox" name="tags" value="python" {% if 'python' in filters.tags %}checked{% endif %} class="sr-only peer">
                    <span class="inline-flex items-center px-gh-2 py-1 text-xs font-medium rounded-gh border border-gh-border-default dark:border-gray-700 bg-gh-bg-default dark:bg-gray-800 text-gh-neutral-default dark:text-gray-200 peer-checked:bg-gh-accent-emphasis peer-checked:text-white peer-checked:border-gh-accent-emphasis dark:peer-checked:bg-gh-accent-muted dark:peer-checked:border-gh-accent-muted hover:bg-gh-bg-muted dark:hover:bg-gray-700 transition-colors">
                        Python
                    </span>
                </label>
                <label class="cursor-pointer">
                    <input type="checkbox" name="tags" value="javascript" {% if 'javascript' in filters.tags %}checked{% endif %} class="sr-only peer">
                    <span class="inline-flex items-center px-gh-2 py-1 text-xs font-medium rounded-gh border border-gh-border-default dark:border-gray-700 bg-gh-bg-default dark:bg-gray-800 text-gh-neutral-default dark:text-gray-200 peer-checked:bg-gh-accent-emphasis peer-checked:text-white peer-checked:border-gh-accent-emphasis dark:peer-checked:bg-gh-accent-muted dark:peer-checked:border-gh-accent-muted hover:bg-gh-bg-muted dark:hover:bg-gray-700 transition-colors">
                        JavaScript
                    </span>
                </label>
                <label class="cursor-pointer">
                    <input type="checkbox" name="tags" value="react" {% if 'react' in filters.tags %}checked{% endif %} class="sr-only peer">
                    <span class="inline-flex items-center px-gh-2 py-1 text-xs font-medium rounded-gh border border-gh-border-default dark:border-gray-700 bg-gh-bg-default dark:bg-gray-800 text-gh-neutral-default dark:text-gray-200 peer-checked:bg-gh-accent-emphasis peer-checked:text-white peer-checked:border-gh-accent-emphasis dark:peer-checked:bg-gh-accent-muted dark:peer-checked:border-gh-accent-muted hover:bg-gh-bg-muted dark:hover:bg-gray-700 transition-colors">
                        React
                    </span>
                </label>
                <label class="cursor-pointer">
                    <input type="checkbox" name="tags" value="ai" {% if 'ai' in filters.tags %}checked{% endif %} class="sr-only peer">
                    <span class="inline-flex items-center px-gh-2 py-1 text-xs font-medium rounded-gh border border-gh-border-default dark:border-gray-700 bg-gh-bg-default dark:bg-gray-800 text-gh-neutral-default dark:text-gray-200 peer-checked:bg-gh-accent-emphasis peer-checked:text-white peer-checked:border-gh-accent-emphasis dark:peer-checked:bg-gh-accent-muted dark:peer-checked:border-gh-accent-muted hover:bg-gh-bg-muted dark:hover:bg-gray-700 transition-colors">
                        AI/ML
                    </span>
                </label>
                <label class="cursor-pointer">
                    <input type="checkbox" name="tags" value="database" {% if 'database' in filters.tags %}checked{% endif %} class="sr-only peer">
                    <span class="inline-flex items-center px-gh-2 py-1 text-xs font-medium rounded-gh border border-gh-border-default dark:border-gray-700 bg-gh-bg-default dark:bg-gray-800 text-gh-neutral-default dark:text-gray-200 peer-checked:bg-gh-accent-emphasis peer-checked:text-white peer-checked:border-gh-accent-emphasis dark:peer-checked:bg-gh-accent-muted dark:peer-checked:border-gh-accent-muted hover:bg-gh-bg-muted dark:hover:bg-gray-700 transition-colors">
                        Database
                    </span>
                </label>
                <label class="cursor-pointer">
                    <input type="checkbox" name="tags" value="api" {% if 'api' in filters.tags %}checked{% endif %} class="sr-only peer">
                    <span class="inline-flex items-center px-gh-2 py-1 text-xs font-medium rounded-gh border border-gh-border-default dark:border-gray-700 bg-gh-bg-default dark:bg-gray-800 text-gh-neutral-default dark:text-gray-200 peer-checked:bg-gh-accent-emphasis peer-checked:text-white peer-checked:border-gh-accent-emphasis dark:peer-checked:bg-gh-accent-muted dark:peer-checked:border-gh-accent-muted hover:bg-gh-bg-muted dark:hover:bg-gray-700 transition-colors">
                        API
                    </span>
                </label>
            </div>
        </div>

        <!-- XP Range Filter -->
        <div class="filter-section mb-gh-6">
            <h3 class="text-sm font-semibold text-gh-neutral-emphasis dark:text-white mb-gh-3">XP Range</h3>
            <div class="space-y-gh-3">
                <div>
                    <label for="xp_min" class="block text-xs text-gh-neutral-muted dark:text-gray-400 mb-gh-1">Min XP</label>
                    <input
                        type="number"
                        id="xp_min"
                        name="xp_min"
                        value="{{ filters.xp_min|default:'' }}"
                        min="0"
                        step="50"
                        placeholder="0"
                        class="w-full px-gh-3 py-gh-2 text-sm border border-gh-border-default dark:border-gray-600 rounded-gh bg-gh-bg-default dark:bg-gray-800 text-gh-neutral-default dark:text-gray-200 placeholder-gh-neutral-muted dark:placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-gh-accent-emphasis dark:focus:ring-gh-accent-muted focus:border-transparent">
                </div>
                <div>
                    <label for="xp_max" class="block text-xs text-gh-neutral-muted dark:text-gray-400 mb-gh-1">Max XP</label>
                    <input
                        type="number"
                        id="xp_max"
                        name="xp_max"
                        value="{{ filters.xp_max|default:'' }}"
                        min="0"
                        step="50"
                        placeholder="1000"
                        class="w-full px-gh-3 py-gh-2 text-sm border border-gh-border-default dark:border-gray-600 rounded-gh bg-gh-bg-default dark:bg-gray-800 text-gh-neutral-default dark:text-gray-200 placeholder-gh-neutral-muted dark:placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-gh-accent-emphasis dark:focus:ring-gh-accent-muted focus:border-transparent">
                </div>
            </div>
        </div>

        <!-- Apply Button -->
        <div class="pt-gh-4 border-t border-gh-border-default dark:border-gray-700">
            <button type="submit" class="btn-gh btn-gh-primary w-full">
                Apply Filters
            </button>
        </div>
    </form>
</div>
{% endblock navigation_sidebar %}

{% block main_content %}
<div class="p-gh-6 space-y-gh-6">
    <!-- Page Header -->
    <div class="flex items-center justify-between">
        <div>
            <h1 class="text-3xl font-bold text-gh-neutral-emphasis dark:text-white mb-gh-2">Quests</h1>
            <p class="text-gh-neutral-muted dark:text-gray-400">
                Complete quests to earn XP, unlock achievements, and level up your skills
            </p>
        </div>
    </div>

    <!-- Active Filters Display -->
    {% if filters %}
    <div class="flex flex-wrap items-center gap-gh-2 p-gh-3 bg-gh-bg-subtle dark:bg-gray-800 border border-gh-border-default dark:border-gray-700 rounded-gh">
        <span class="text-sm font-medium text-gh-neutral-emphasis dark:text-white">Active filters:</span>
        {% if filters.difficulty %}
            {% for diff in filters.difficulty %}
            <span class="inline-flex items-center gap-gh-1 px-gh-2 py-1 text-xs font-medium rounded-gh bg-gh-accent-subtle dark:bg-gray-700 text-gh-accent-fg dark:text-gh-accent-muted border border-gh-accent-emphasis dark:border-gh-accent-muted">
                Difficulty: {{ diff|capfirst }}
                <button type="button" onclick="removeFilter('difficulty', '{{ diff }}')" class="hover:text-gh-danger-fg dark:hover:text-red-400">×</button>
            </span>
            {% endfor %}
        {% endif %}
        {% if filters.type %}
            {% for t in filters.type %}
            <span class="inline-flex items-center gap-gh-1 px-gh-2 py-1 text-xs font-medium rounded-gh bg-gh-accent-subtle dark:bg-gray-700 text-gh-accent-fg dark:text-gh-accent-muted border border-gh-accent-emphasis dark:border-gh-accent-muted">
                Type: {{ t|capfirst }}
                <button type="button" onclick="removeFilter('type', '{{ t }}')" class="hover:text-gh-danger-fg dark:hover:text-red-400">×</button>
            </span>
            {% endfor %}
        {% endif %}
        {% if filters.tags %}
            {% for tag in filters.tags %}
            <span class="inline-flex items-center gap-gh-1 px-gh-2 py-1 text-xs font-medium rounded-gh bg-gh-accent-subtle dark:bg-gray-700 text-gh-accent-fg dark:text-gh-accent-muted border border-gh-accent-emphasis dark:border-gh-accent-muted">
                Tag: {{ tag }}
                <button type="button" onclick="removeFilter('tags', '{{ tag }}')" class="hover:text-gh-danger-fg dark:hover:text-red-400">×</button>
            </span>
            {% endfor %}
        {% endif %}
    </div>
    {% endif %}

    <!-- Quest Cards Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-gh-4">
        {% for quest in quests %}
            {% include "components/quest-card.html" with quest=quest %}
        {% empty %}
        <div class="col-span-full p-gh-8 text-center">
            <div class="mb-gh-4">
                <svg class="w-16 h-16 mx-auto text-gh-neutral-muted dark:text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
            </div>
            <h3 class="text-lg font-semibold text-gh-neutral-emphasis dark:text-white mb-gh-2">No quests found</h3>
            <p class="text-gh-neutral-muted dark:text-gray-400 mb-gh-4">
                Try adjusting your filters or check back later for new quests.
            </p>
            <a href="?" class="btn-gh btn-gh-primary">Clear Filters</a>
        </div>
        {% endfor %}
    </div>

    <!-- Pagination -->
    {% if page_obj %}
        {% include "components/pagination.html" with paginator_page=page_obj %}
    {% endif %}
</div>
{% endblock main_content %}

{% block detail_sidebar %}
<div class="p-gh-4 space-y-gh-6">
    <!-- User Progress Stats -->
    <div class="card-gh p-gh-4">
        <h2 class="text-lg font-semibold text-gh-neutral-emphasis dark:text-white mb-gh-4 pb-gh-3 border-b border-gh-border-default dark:border-gray-700">
            Your Progress
        </h2>
        <div class="space-y-gh-4">
            <div class="flex items-center justify-between p-gh-3 bg-gh-bg-subtle dark:bg-gray-800 border border-gh-border-default dark:border-gray-700 rounded-gh">
                <div class="flex items-center gap-gh-2">
                    <svg class="w-5 h-5 text-gh-accent-fg dark:text-gh-accent-muted" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <span class="text-sm text-gh-neutral-muted dark:text-gray-400">Completed</span>
                </div>
                <span class="text-2xl font-bold text-gh-neutral-emphasis dark:text-white">{{ user_stats.completed_count|default:"0" }}</span>
            </div>
            <div class="flex items-center justify-between p-gh-3 bg-gh-bg-subtle dark:bg-gray-800 border border-gh-border-default dark:border-gray-700 rounded-gh">
                <div class="flex items-center gap-gh-2">
                    <svg class="w-5 h-5 text-gh-accent-fg dark:text-gh-accent-muted" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" />
                    </svg>
                    <span class="text-sm text-gh-neutral-muted dark:text-gray-400">Total XP</span>
                </div>
                <span class="text-2xl font-bold text-gh-accent-fg dark:text-gh-accent-muted">{{ user_stats.total_xp|default:"0" }}</span>
            </div>
            <div class="flex items-center justify-between p-gh-3 bg-gh-bg-subtle dark:bg-gray-800 border border-gh-border-default dark:border-gray-700 rounded-gh">
                <div class="flex items-center gap-gh-2">
                    <svg class="w-5 h-5 text-gh-accent-fg dark:text-gh-accent-muted" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                    </svg>
                    <span class="text-sm text-gh-neutral-muted dark:text-gray-400">Current Streak</span>
                </div>
                <span class="text-2xl font-bold text-gh-accent-fg dark:text-gh-accent-muted">{{ user_stats.current_streak|default:"0" }}</span>
            </div>
        </div>
    </div>

    <!-- Recommended Quests -->
    {% if recommended_quests %}
    <div class="card-gh p-gh-4">
        <h2 class="text-lg font-semibold text-gh-neutral-emphasis dark:text-white mb-gh-4 pb-gh-3 border-b border-gh-border-default dark:border-gray-700">
            Recommended for You
        </h2>
        <div class="space-y-gh-3">
            {% for quest in recommended_quests|slice:":5" %}
            <a href="{{ quest.url }}" class="block p-gh-3 bg-gh-bg-subtle dark:bg-gray-800 border border-gh-border-default dark:border-gray-700 rounded-gh hover:bg-gh-bg-muted dark:hover:bg-gray-750 hover:border-gh-accent-emphasis dark:hover:border-gh-accent-muted transition-all">
                <div class="flex items-start justify-between mb-gh-2">
                    <h3 class="text-sm font-semibold text-gh-neutral-emphasis dark:text-white line-clamp-2">{{ quest.title }}</h3>
                    {% if quest.difficulty %}
                    <span class="badge-gh {% if quest.difficulty == 'easy' %}badge-gh-success{% elif quest.difficulty == 'medium' %}badge-gh-warning{% elif quest.difficulty == 'hard' %}badge-gh-danger{% endif %} text-xs shrink-0 ml-gh-2">
                        {{ quest.get_difficulty_display|default:quest.difficulty|capfirst }}
                    </span>
                    {% endif %}
                </div>
                <div class="flex items-center gap-gh-3 text-xs text-gh-neutral-muted dark:text-gray-400">
                    <span class="flex items-center gap-gh-1">
                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" />
                        </svg>
                        {{ quest.xp_reward }} XP
                    </span>
                    {% if quest.estimated_hours %}
                    <span class="flex items-center gap-gh-1">
                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        ~{{ quest.estimated_hours }}h
                    </span>
                    {% endif %}
                </div>
            </a>
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>
{% endblock detail_sidebar %}

{% block extra_js %}
<script>
// Helper function to remove individual filter values
function removeFilter(filterType, value) {
    const url = new URL(window.location);
    const params = new URLSearchParams(url.search);

    // Get all values for this filter type
    const values = params.getAll(filterType);

    // Remove all instances of this filter type
    params.delete(filterType);

    // Add back all values except the one we're removing
    values.forEach(v => {
        if (v !== value) {
            params.append(filterType, v);
        }
    });

    // Navigate to new URL
    window.location.href = url.pathname + '?' + params.toString();
}
</script>
{% endblock extra_js %}

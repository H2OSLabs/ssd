<div class="countdown-timer inline-flex items-center space-x-2 text-sm"
     x-data="countdown('{{ end_date|date:'c' }}')"
     x-init="start()">
    <div class="countdown-segment">
        <span class="font-mono font-bold" x-text="days">0</span>
        <span class="text-xs">d</span>
    </div>
    <span>:</span>
    <div class="countdown-segment">
        <span class="font-mono font-bold" x-text="hours">0</span>
        <span class="text-xs">h</span>
    </div>
    <span>:</span>
    <div class="countdown-segment">
        <span class="font-mono font-bold" x-text="minutes">0</span>
        <span class="text-xs">m</span>
    </div>
</div>

<script>
function countdown(endDateISO) {
    return {
        days: 0,
        hours: 0,
        minutes: 0,
        seconds: 0,
        interval: null,

        start() {
            this.update();
            this.interval = setInterval(() => this.update(), 1000);
        },

        update() {
            const end = new Date(endDateISO);
            const now = new Date();
            const diff = end - now;

            if (diff <= 0) {
                clearInterval(this.interval);
                this.days = this.hours = this.minutes = this.seconds = 0;
                return;
            }

            this.days = Math.floor(diff / (1000 * 60 * 60 * 24));
            this.hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            this.minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            this.seconds = Math.floor((diff % (1000 * 60)) / 1000);
        }
    };
}
</script>
